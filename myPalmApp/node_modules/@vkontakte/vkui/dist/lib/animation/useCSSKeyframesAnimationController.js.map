{"version":3,"sources":["../../../src/lib/animation/useCSSKeyframesAnimationController.ts"],"sourcesContent":["import * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { useStableCallback } from '../../hooks/useStableCallback';\nimport { useIsomorphicLayoutEffect } from '../useIsomorphicLayoutEffect';\n\nexport type UseCSSAnimationControllerCallback = {\n  onEnter?: VoidFunction;\n  onEntering?: VoidFunction;\n  onEntered?: VoidFunction;\n  onExit?: VoidFunction;\n  onExiting?: VoidFunction;\n  onExited?: VoidFunction;\n};\n\nexport type AnimationState = 'enter' | 'entering' | 'entered' | 'exit' | 'exiting' | 'exited';\n\nexport type AnimationHandlers = { onAnimationStart: VoidFunction; onAnimationEnd: VoidFunction };\n\nexport const useCSSKeyframesAnimationController = (\n  stateProp: 'enter' | 'exit',\n  {\n    onEnter: onEnterProp,\n    onEntering,\n    onEntered,\n    onExit: onExitProp,\n    onExiting,\n    onExited,\n  }: UseCSSAnimationControllerCallback = {},\n  disableInitAnimation = false,\n): [AnimationState, AnimationHandlers] => {\n  const [state, setState] = React.useState<AnimationState>(() =>\n    disableInitAnimation ? (stateProp === 'enter' ? 'entered' : 'exited') : stateProp,\n  );\n\n  const prevStateRef = React.useRef<'enter' | 'exit' | undefined>(undefined);\n  React.useEffect(() => {\n    prevStateRef.current = stateProp;\n  });\n\n  const onAnimationStart = () => {\n    if (state === 'enter') {\n      setState('entering');\n      if (onEntering) {\n        onEntering();\n      }\n    } else if (state === 'exit') {\n      setState('exiting');\n      if (onExiting) {\n        onExiting();\n      }\n    }\n  };\n\n  const onAnimationEnd = () => {\n    if (state === 'entering') {\n      setState('entered');\n      if (onEntered) {\n        onEntered();\n      }\n    } else if (state === 'exiting') {\n      setState('exited');\n      if (onExited) {\n        onExited();\n      }\n    }\n  };\n\n  const onEnter = useStableCallback(onEnterProp || noop);\n  const onExit = useStableCallback(onExitProp || noop);\n\n  useIsomorphicLayoutEffect(\n    function updateState() {\n      const prevState = prevStateRef.current;\n\n      if (prevState === stateProp) {\n        return;\n      }\n      switch (stateProp) {\n        case 'enter':\n          if (state === 'entering' || state === 'entered') {\n            break;\n          }\n\n          setState('enter');\n          onEnter();\n          break;\n        case 'exit':\n          if (state === 'exiting' || state === 'exited') {\n            break;\n          }\n\n          setState('exit');\n          onExit();\n          break;\n      }\n    },\n    [state, stateProp, onEnter, onExit],\n  );\n\n  return [state, { onAnimationStart, onAnimationEnd }];\n};\n"],"names":["React","noop","useStableCallback","useIsomorphicLayoutEffect","useCSSKeyframesAnimationController","stateProp","onEnter","onEnterProp","onEntering","onEntered","onExit","onExitProp","onExiting","onExited","disableInitAnimation","state","setState","useState","prevStateRef","useRef","undefined","useEffect","current","onAnimationStart","onAnimationEnd","updateState","prevState"],"mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,IAAI,QAAQ,kBAAkB;AACvC,SAASC,iBAAiB,QAAQ,mCAAgC;AAClE,SAASC,yBAAyB,QAAQ,kCAA+B;AAezE,OAAO,MAAMC,qCAAqC,CAChDC,WACA,EACEC,SAASC,WAAW,EACpBC,UAAU,EACVC,SAAS,EACTC,QAAQC,UAAU,EAClBC,SAAS,EACTC,QAAQ,EAC0B,GAAG,CAAC,CAAC,EACzCC,uBAAuB,KAAK;IAE5B,MAAM,CAACC,OAAOC,SAAS,GAAGhB,MAAMiB,QAAQ,CAAiB,IACvDH,uBAAwBT,cAAc,UAAU,YAAY,WAAYA;IAG1E,MAAMa,eAAelB,MAAMmB,MAAM,CAA+BC;IAChEpB,MAAMqB,SAAS,CAAC;QACdH,aAAaI,OAAO,GAAGjB;IACzB;IAEA,MAAMkB,mBAAmB;QACvB,IAAIR,UAAU,SAAS;YACrBC,SAAS;YACT,IAAIR,YAAY;gBACdA;YACF;QACF,OAAO,IAAIO,UAAU,QAAQ;YAC3BC,SAAS;YACT,IAAIJ,WAAW;gBACbA;YACF;QACF;IACF;IAEA,MAAMY,iBAAiB;QACrB,IAAIT,UAAU,YAAY;YACxBC,SAAS;YACT,IAAIP,WAAW;gBACbA;YACF;QACF,OAAO,IAAIM,UAAU,WAAW;YAC9BC,SAAS;YACT,IAAIH,UAAU;gBACZA;YACF;QACF;IACF;IAEA,MAAMP,UAAUJ,kBAAkBK,eAAeN;IACjD,MAAMS,SAASR,kBAAkBS,cAAcV;IAE/CE,0BACE,SAASsB;QACP,MAAMC,YAAYR,aAAaI,OAAO;QAEtC,IAAII,cAAcrB,WAAW;YAC3B;QACF;QACA,OAAQA;YACN,KAAK;gBACH,IAAIU,UAAU,cAAcA,UAAU,WAAW;oBAC/C;gBACF;gBAEAC,SAAS;gBACTV;gBACA;YACF,KAAK;gBACH,IAAIS,UAAU,aAAaA,UAAU,UAAU;oBAC7C;gBACF;gBAEAC,SAAS;gBACTN;gBACA;QACJ;IACF,GACA;QAACK;QAAOV;QAAWC;QAASI;KAAO;IAGrC,OAAO;QAACK;QAAO;YAAEQ;YAAkBC;QAAe;KAAE;AACtD,EAAE"}