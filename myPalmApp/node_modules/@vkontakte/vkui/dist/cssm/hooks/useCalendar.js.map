{"version":3,"sources":["../../../src/hooks/useCalendar.ts"],"sourcesContent":["import * as React from 'react';\nimport { addMonths, endOfDay, isAfter, isBefore, isSameDay, startOfDay, subMonths } from 'date-fns';\nimport type { CalendarProps } from '../components/Calendar/Calendar';\nimport { DEFAULT_MAX_YEAR, DEFAULT_MIN_YEAR, isDayMinMaxRestricted } from '../lib/calendar';\n\nexport interface UseCalendarDependencies\n  extends Pick<\n    CalendarProps,\n    | 'onHeaderChange'\n    | 'onNextMonth'\n    | 'onPrevMonth'\n    | 'minDateTime'\n    | 'maxDateTime'\n    | 'shouldDisableDate'\n    | 'disableFuture'\n    | 'disablePast'\n  > {\n  value?: Array<Date | null> | Date | null;\n}\n\nexport function useCalendar({\n  value,\n  disablePast,\n  disableFuture,\n  shouldDisableDate,\n  onHeaderChange,\n  onNextMonth,\n  onPrevMonth,\n  minDateTime,\n  maxDateTime,\n}: UseCalendarDependencies): {\n  viewDate: Date;\n  setViewDate: (value: Date) => void;\n  setPrevMonth: () => void;\n  setNextMonth: () => void;\n  focusedDay: Date | undefined;\n  setFocusedDay: React.Dispatch<React.SetStateAction<Date | undefined>>;\n  focusableDay: Date | undefined;\n  setFocusableDay: React.Dispatch<React.SetStateAction<Date | undefined>>;\n  isDayFocused: (day: Date) => boolean;\n  isDayDisabled: (day: Date, withTime?: boolean) => boolean;\n  resetSelectedDay: () => void;\n  isMonthDisabled: (month: number, year?: number) => boolean;\n  isYearDisabled: (year: number) => boolean;\n} {\n  const [viewDate, setViewDate] = React.useState(\n    (Array.isArray(value) ? value[0] : value) ?? new Date(),\n  );\n  // соответствует дню, на котором сейчас есть фокус\n  // меняется при переключении дней с помощью стрелок\n  const [focusedDay, setFocusedDay] = React.useState<Date>();\n  // соотвествует дню, на котором можно сфокусироваться с помощью Tab\n  const [focusableDay, setFocusableDay] = React.useState<Date>();\n\n  const setPrevMonth = React.useCallback(() => {\n    onPrevMonth?.();\n    setViewDate(subMonths(viewDate, 1));\n  }, [viewDate, onPrevMonth]);\n  const setNextMonth = React.useCallback(() => {\n    onNextMonth?.();\n    setViewDate(addMonths(viewDate, 1));\n  }, [viewDate, onNextMonth]);\n\n  const handleSetViewDate = React.useCallback(\n    (value: Date) => {\n      onHeaderChange?.(value);\n      setViewDate(value);\n    },\n    [onHeaderChange],\n  );\n\n  const isDayFocused = React.useCallback(\n    (day: Date) => Boolean(focusedDay && isSameDay(day, focusedDay)),\n    [focusedDay],\n  );\n\n  const isDayDisabled = React.useCallback(\n    (day: Date, withTime?: boolean) => {\n      const now = new Date();\n      if (shouldDisableDate) {\n        return shouldDisableDate(day);\n      }\n      if (disableFuture) {\n        return isAfter(startOfDay(day), now);\n      }\n      if (disablePast) {\n        return isBefore(endOfDay(day), now);\n      }\n      if (minDateTime || maxDateTime) {\n        return isDayMinMaxRestricted(day, { min: minDateTime, max: maxDateTime, withTime });\n      }\n\n      return false;\n    },\n    [disableFuture, disablePast, shouldDisableDate, minDateTime, maxDateTime],\n  );\n\n  const isMonthDisabled = React.useCallback(\n    (month: number, year?: number): boolean => {\n      const now = new Date();\n      year = year || viewDate.getFullYear();\n      const minMonth = minDateTime ? minDateTime.getMonth() : 0;\n      const maxMonth = maxDateTime ? maxDateTime.getMonth() : 11;\n      const minYear = minDateTime?.getFullYear() || DEFAULT_MIN_YEAR;\n      const maxYear = maxDateTime?.getFullYear() || DEFAULT_MAX_YEAR;\n\n      let isDisabled =\n        year >= minYear && year <= maxYear\n          ? (year === minYear && minMonth > month) || (year === maxYear && month > maxMonth)\n          : true;\n\n      if (disableFuture) {\n        isDisabled =\n          isDisabled ||\n          (year === now.getFullYear() ? month > now.getMonth() : year > now.getFullYear());\n      }\n      if (disablePast) {\n        isDisabled =\n          isDisabled ||\n          (year === now.getFullYear() ? month < now.getMonth() : year < now.getFullYear());\n      }\n\n      return isDisabled;\n    },\n    [disableFuture, disablePast, viewDate, minDateTime, maxDateTime],\n  );\n\n  const isYearDisabled = React.useCallback(\n    (year: number): boolean => {\n      const now = new Date();\n      const minYear = minDateTime?.getFullYear() || DEFAULT_MIN_YEAR;\n      const maxYear = maxDateTime?.getFullYear() || DEFAULT_MAX_YEAR;\n\n      let isDisabled = minYear > year || year > maxYear;\n      if (disableFuture) {\n        isDisabled = isDisabled || year > now.getFullYear();\n      }\n      if (disablePast) {\n        isDisabled = isDisabled || year < now.getFullYear();\n      }\n\n      return isDisabled;\n    },\n    [disableFuture, disablePast, minDateTime, maxDateTime],\n  );\n\n  const resetSelectedDay = React.useCallback(() => {\n    setFocusedDay(undefined);\n  }, [setFocusedDay]);\n\n  return {\n    viewDate,\n    setViewDate: handleSetViewDate,\n    setPrevMonth,\n    setNextMonth,\n    focusedDay,\n    setFocusedDay,\n    focusableDay,\n    setFocusableDay,\n    isDayFocused,\n    isDayDisabled,\n    resetSelectedDay,\n    isMonthDisabled,\n    isYearDisabled,\n  };\n}\n"],"names":["React","addMonths","endOfDay","isAfter","isBefore","isSameDay","startOfDay","subMonths","DEFAULT_MAX_YEAR","DEFAULT_MIN_YEAR","isDayMinMaxRestricted","useCalendar","value","disablePast","disableFuture","shouldDisableDate","onHeaderChange","onNextMonth","onPrevMonth","minDateTime","maxDateTime","viewDate","setViewDate","useState","Array","isArray","Date","focusedDay","setFocusedDay","focusableDay","setFocusableDay","setPrevMonth","useCallback","setNextMonth","handleSetViewDate","isDayFocused","day","Boolean","isDayDisabled","withTime","now","min","max","isMonthDisabled","month","year","getFullYear","minMonth","getMonth","maxMonth","minYear","maxYear","isDisabled","isYearDisabled","resetSelectedDay","undefined"],"mappings":"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"}