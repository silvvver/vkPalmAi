{"version":3,"sources":["../../../../../src/components/ImageBase/ImageBaseOverlay/ImageBaseOverlay.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useColorScheme } from '../../../hooks/useColorScheme';\nimport { useExternRef } from '../../../hooks/useExternRef';\nimport { useFocusVisible } from '../../../hooks/useFocusVisible';\nimport { useFocusVisibleClassName } from '../../../hooks/useFocusVisibleClassName';\nimport { clickByKeyboardHandler } from '../../../lib/utils';\nimport { ImageBaseContext } from '../context';\nimport { validateOverlayIcon } from '../validators';\nimport { useCalculatedDefaultVisibility, useNonInteractiveOverlayProps } from './hooks';\nimport type {\n  ImageBaseOverlayInteractiveProps,\n  ImageBaseOverlayNonInteractiveProps,\n} from './types';\nimport styles from './ImageBaseOverlay.module.css';\n\nfunction DevelopmentCheck({ children }: Pick<ImageBaseOverlayInteractiveProps, 'children'>) {\n  const { size } = React.useContext(ImageBaseContext);\n\n  if (process.env.NODE_ENV === 'development') {\n    if (children) {\n      validateOverlayIcon(size, { name: 'children', value: children });\n    }\n  }\n\n  return null;\n}\n\nexport type ImageBaseOverlayProps =\n  | ImageBaseOverlayInteractiveProps\n  | ImageBaseOverlayNonInteractiveProps;\n\nconst ImageBaseOverlayInteractive = ({\n  children,\n  className,\n  getRootRef,\n  overlayShown,\n  ...restProps\n}: ImageBaseOverlayInteractiveProps & { overlayShown?: boolean }) => {\n  const { focusVisible, ...focusEvents } = useFocusVisible();\n  const focusVisibleClassNames = useFocusVisibleClassName({ focusVisible, mode: 'inside' });\n\n  return (\n    <>\n      <div\n        {...restProps}\n        tabIndex={0}\n        role=\"button\"\n        className={classNames(\n          styles.clickable,\n          (focusVisible || overlayShown) && styles.visible,\n          focusVisibleClassNames,\n          className,\n        )}\n        ref={getRootRef}\n        onKeyDown={clickByKeyboardHandler}\n        {...focusEvents}\n      >\n        {children}\n      </div>\n      {process.env.NODE_ENV === 'development' && <DevelopmentCheck>{children}</DevelopmentCheck>}\n    </>\n  );\n};\n\nconst ImageBaseOverlayNonInteractive = ({\n  className,\n  getRootRef,\n  overlayShown: overlayShownProps,\n  ...restProps\n}: ImageBaseOverlayNonInteractiveProps & { overlayShown?: boolean }) => {\n  const rootRef = useExternRef(getRootRef);\n  const { shown: overlayShown, onClick: onOverlayClick } = useNonInteractiveOverlayProps(rootRef);\n\n  return (\n    <div\n      {...restProps}\n      ref={rootRef}\n      className={classNames((overlayShown || overlayShownProps) && styles.visible, className)}\n      onClick={onOverlayClick}\n    />\n  );\n};\n\n/**\n * Оверлей над картинкой.\n */\nexport const ImageBaseOverlay = ({\n  className,\n  theme: themeProp,\n  visibility: visibilityProp,\n  ...restProps\n}: ImageBaseOverlayProps) => {\n  const colorScheme = useColorScheme();\n\n  const theme = themeProp ?? colorScheme;\n\n  const commonClassNames = classNames(\n    styles.host,\n    theme === 'light' && styles.themeLight,\n    theme === 'dark' && styles.themeDark,\n    className,\n  );\n\n  const defaultVisibility = useCalculatedDefaultVisibility();\n  const visibility = visibilityProp ?? defaultVisibility;\n\n  const commonProps = {\n    className: commonClassNames,\n    overlayShown: visibility === 'always',\n  };\n\n  // Не делаем деструктуризацию пропа, потому что Typescript не вывозит\n  if (!restProps.onClick) {\n    return <ImageBaseOverlayNonInteractive {...restProps} {...commonProps} />;\n  }\n\n  return <ImageBaseOverlayInteractive {...restProps} {...commonProps} />;\n};\n"],"names":["React","classNames","useColorScheme","useExternRef","useFocusVisible","useFocusVisibleClassName","clickByKeyboardHandler","ImageBaseContext","validateOverlayIcon","useCalculatedDefaultVisibility","useNonInteractiveOverlayProps","styles","DevelopmentCheck","children","size","useContext","process","env","NODE_ENV","name","value","ImageBaseOverlayInteractive","className","getRootRef","overlayShown","restProps","focusVisible","focusEvents","focusVisibleClassNames","mode","div","tabIndex","role","clickable","visible","ref","onKeyDown","ImageBaseOverlayNonInteractive","overlayShownProps","rootRef","shown","onClick","onOverlayClick","ImageBaseOverlay","theme","themeProp","visibility","visibilityProp","colorScheme","commonClassNames","host","themeLight","themeDark","defaultVisibility","commonProps"],"mappings":"AAAA;;AAEA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,SAASC,cAAc,QAAQ,mCAAgC;AAC/D,SAASC,YAAY,QAAQ,iCAA8B;AAC3D,SAASC,eAAe,QAAQ,oCAAiC;AACjE,SAASC,wBAAwB,QAAQ,6CAA0C;AACnF,SAASC,sBAAsB,QAAQ,wBAAqB;AAC5D,SAASC,gBAAgB,QAAQ,gBAAa;AAC9C,SAASC,mBAAmB,QAAQ,mBAAgB;AACpD,SAASC,8BAA8B,EAAEC,6BAA6B,QAAQ,aAAU;AAKxF,OAAOC,YAAY,gCAAgC;AAEnD,SAASC,iBAAiB,EAAEC,QAAQ,EAAsD;IACxF,MAAM,EAAEC,IAAI,EAAE,GAAGd,MAAMe,UAAU,CAACR;IAElC,IAAIS,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;QAC1C,IAAIL,UAAU;YACZL,oBAAoBM,MAAM;gBAAEK,MAAM;gBAAYC,OAAOP;YAAS;QAChE;IACF;IAEA,OAAO;AACT;AAMA,MAAMQ,8BAA8B,CAAC,EACnCR,QAAQ,EACRS,SAAS,EACTC,UAAU,EACVC,YAAY,EACZ,GAAGC,WAC2D;IAC9D,MAAM,EAAEC,YAAY,EAAE,GAAGC,aAAa,GAAGvB;IACzC,MAAMwB,yBAAyBvB,yBAAyB;QAAEqB;QAAcG,MAAM;IAAS;IAEvF,qBACE;;0BACE,KAACC;gBACE,GAAGL,SAAS;gBACbM,UAAU;gBACVC,MAAK;gBACLV,WAAWrB,WACTU,OAAOsB,SAAS,EAChB,AAACP,CAAAA,gBAAgBF,YAAW,KAAMb,OAAOuB,OAAO,EAChDN,wBACAN;gBAEFa,KAAKZ;gBACLa,WAAW9B;gBACV,GAAGqB,WAAW;0BAEdd;;YAEFG,QAAQC,GAAG,CAACC,QAAQ,KAAK,+BAAiB,KAACN;0BAAkBC;;;;AAGpE;AAEA,MAAMwB,iCAAiC,CAAC,EACtCf,SAAS,EACTC,UAAU,EACVC,cAAcc,iBAAiB,EAC/B,GAAGb,WAC8D;IACjE,MAAMc,UAAUpC,aAAaoB;IAC7B,MAAM,EAAEiB,OAAOhB,YAAY,EAAEiB,SAASC,cAAc,EAAE,GAAGhC,8BAA8B6B;IAEvF,qBACE,KAACT;QACE,GAAGL,SAAS;QACbU,KAAKI;QACLjB,WAAWrB,WAAW,AAACuB,CAAAA,gBAAgBc,iBAAgB,KAAM3B,OAAOuB,OAAO,EAAEZ;QAC7EmB,SAASC;;AAGf;AAEA;;CAEC,GACD,OAAO,MAAMC,mBAAmB,CAAC,EAC/BrB,SAAS,EACTsB,OAAOC,SAAS,EAChBC,YAAYC,cAAc,EAC1B,GAAGtB,WACmB;IACtB,MAAMuB,cAAc9C;IAEpB,MAAM0C,QAAQC,aAAaG;IAE3B,MAAMC,mBAAmBhD,WACvBU,OAAOuC,IAAI,EACXN,UAAU,WAAWjC,OAAOwC,UAAU,EACtCP,UAAU,UAAUjC,OAAOyC,SAAS,EACpC9B;IAGF,MAAM+B,oBAAoB5C;IAC1B,MAAMqC,aAAaC,kBAAkBM;IAErC,MAAMC,cAAc;QAClBhC,WAAW2B;QACXzB,cAAcsB,eAAe;IAC/B;IAEA,qEAAqE;IACrE,IAAI,CAACrB,UAAUgB,OAAO,EAAE;QACtB,qBAAO,KAACJ;YAAgC,GAAGZ,SAAS;YAAG,GAAG6B,WAAW;;IACvE;IAEA,qBAAO,KAACjC;QAA6B,GAAGI,SAAS;QAAG,GAAG6B,WAAW;;AACpE,EAAE"}