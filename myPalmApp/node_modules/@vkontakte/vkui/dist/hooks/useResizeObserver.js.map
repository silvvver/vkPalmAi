{"version":3,"sources":["../../src/hooks/useResizeObserver.ts"],"sourcesContent":["import { useEffect } from 'react';\nimport type * as React from 'react';\nimport { useDOM } from '../lib/dom';\nimport { CustomResizeObserver } from '../lib/floating/customResizeObserver';\nimport { isRefObject } from '../lib/isRefObject';\nimport { useStableCallback } from './useStableCallback';\n\n/**\n * Хук вызывает переданный коллбэк при изменении размеров элемента.\n */\nexport function useResizeObserver(\n  ref: React.RefObject<HTMLElement | null> | Window | null | undefined,\n  callback: (element: HTMLElement | Window) => void,\n): void {\n  const stableCallback = useStableCallback(callback);\n  const { window } = useDOM();\n\n  useEffect(\n    function addResizeObserverHandler() {\n      if (!ref || !window) {\n        return;\n      }\n\n      if (ref === window) {\n        const onResize = () => stableCallback(ref);\n        ref.addEventListener('resize', onResize);\n        return () => ref.removeEventListener('resize', onResize);\n      }\n\n      /* istanbul ignore if: невозможный кейс (в SSR вызова этой функции не будет) */\n      if (!isRefObject(ref) || !ref.current) {\n        return;\n      }\n      const element = ref.current;\n      const canUseResizeObserver =\n        'ResizeObserver' in window && window.ResizeObserver !== undefined;\n\n      const observeFn = () => stableCallback(element);\n\n      const observer: ResizeObserver | CustomResizeObserver = canUseResizeObserver\n        ? // eslint-disable-next-line compat/compat\n          new ResizeObserver(observeFn)\n        : new CustomResizeObserver(observeFn);\n      observer.observe(element);\n\n      if (observer instanceof CustomResizeObserver) {\n        observer.appendToTheDOM();\n      }\n\n      return () => observer.disconnect();\n    },\n    [ref, stableCallback, window],\n  );\n}\n"],"names":["useEffect","useDOM","CustomResizeObserver","isRefObject","useStableCallback","useResizeObserver","ref","callback","stableCallback","window","addResizeObserverHandler","onResize","addEventListener","removeEventListener","current","element","canUseResizeObserver","ResizeObserver","undefined","observeFn","observer","observe","appendToTheDOM","disconnect"],"mappings":"AAAA,SAASA,SAAS,QAAQ,QAAQ;AAElC,SAASC,MAAM,QAAQ,gBAAa;AACpC,SAASC,oBAAoB,QAAQ,0CAAuC;AAC5E,SAASC,WAAW,QAAQ,wBAAqB;AACjD,SAASC,iBAAiB,QAAQ,yBAAsB;AAExD;;CAEC,GACD,OAAO,SAASC,kBACdC,GAAoE,EACpEC,QAAiD;IAEjD,MAAMC,iBAAiBJ,kBAAkBG;IACzC,MAAM,EAAEE,MAAM,EAAE,GAAGR;IAEnBD,UACE,SAASU;QACP,IAAI,CAACJ,OAAO,CAACG,QAAQ;YACnB;QACF;QAEA,IAAIH,QAAQG,QAAQ;YAClB,MAAME,WAAW,IAAMH,eAAeF;YACtCA,IAAIM,gBAAgB,CAAC,UAAUD;YAC/B,OAAO,IAAML,IAAIO,mBAAmB,CAAC,UAAUF;QACjD;QAEA,6EAA6E,GAC7E,IAAI,CAACR,YAAYG,QAAQ,CAACA,IAAIQ,OAAO,EAAE;YACrC;QACF;QACA,MAAMC,UAAUT,IAAIQ,OAAO;QAC3B,MAAME,uBACJ,oBAAoBP,UAAUA,OAAOQ,cAAc,KAAKC;QAE1D,MAAMC,YAAY,IAAMX,eAAeO;QAEvC,MAAMK,WAAkDJ,uBAEpD,IAAIC,eAAeE,aACnB,IAAIjB,qBAAqBiB;QAC7BC,SAASC,OAAO,CAACN;QAEjB,IAAIK,oBAAoBlB,sBAAsB;YAC5CkB,SAASE,cAAc;QACzB;QAEA,OAAO,IAAMF,SAASG,UAAU;IAClC,GACA;QAACjB;QAAKE;QAAgBC;KAAO;AAEjC"}