{"version":3,"sources":["../../../src/components/Gallery/hooks.ts"],"sourcesContent":["/* eslint-disable jsdoc/require-jsdoc */\n\nimport * as React from 'react';\nimport { useStableCallback } from '../../hooks/useStableCallback';\nimport { useDOM } from '../../lib/dom';\nimport type { TimeoutId } from '../../types';\n\nexport interface AutoPlayConfig {\n  timeout: number;\n  slideIndex: number;\n  onNext: VoidFunction;\n}\n\nexport function useAutoPlay({ timeout, slideIndex, onNext }: AutoPlayConfig): {\n  pause: VoidFunction;\n  resume: VoidFunction;\n} {\n  const { document } = useDOM();\n  const [paused, setPaused] = React.useState(false);\n  const timeoutRef = React.useRef<TimeoutId>(null);\n  const callbackFn = useStableCallback(onNext);\n\n  const pause = React.useCallback(() => setPaused(true), []);\n  const resume = React.useCallback(() => setPaused(false), []);\n\n  // Выносим функции очистки и старта таймера в отдельные функции\n  const clearAutoPlayTimeout = React.useCallback(() => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = null;\n    }\n  }, []);\n\n  const startAutoPlayTimeout = React.useCallback(() => {\n    if (!document || !timeout || paused) {\n      return;\n    }\n\n    if (document.visibilityState === 'visible') {\n      clearAutoPlayTimeout();\n      timeoutRef.current = setTimeout(callbackFn, timeout);\n    } else {\n      clearAutoPlayTimeout();\n    }\n  }, [document, timeout, paused, clearAutoPlayTimeout, callbackFn]);\n\n  // Основной эффект для управления автопроигрыванием\n  React.useEffect(\n    function initializeAutoPlay() {\n      if (!document || !timeout || paused) {\n        return;\n      }\n\n      startAutoPlayTimeout();\n      document.addEventListener('visibilitychange', startAutoPlayTimeout);\n\n      return () => {\n        clearAutoPlayTimeout();\n        document.removeEventListener('visibilitychange', startAutoPlayTimeout);\n      };\n    },\n    [document, timeout, slideIndex, startAutoPlayTimeout, clearAutoPlayTimeout, paused],\n  );\n\n  return {\n    resume,\n    pause,\n  };\n}\n"],"names":["React","useStableCallback","useDOM","useAutoPlay","timeout","slideIndex","onNext","document","paused","setPaused","useState","timeoutRef","useRef","callbackFn","pause","useCallback","resume","clearAutoPlayTimeout","current","clearTimeout","startAutoPlayTimeout","visibilityState","setTimeout","useEffect","initializeAutoPlay","addEventListener","removeEventListener"],"mappings":"AAAA,sCAAsC,GAEtC,YAAYA,WAAW,QAAQ;AAC/B,SAASC,iBAAiB,QAAQ,mCAAgC;AAClE,SAASC,MAAM,QAAQ,mBAAgB;AASvC,OAAO,SAASC,YAAY,EAAEC,OAAO,EAAEC,UAAU,EAAEC,MAAM,EAAkB;IAIzE,MAAM,EAAEC,QAAQ,EAAE,GAAGL;IACrB,MAAM,CAACM,QAAQC,UAAU,GAAGT,MAAMU,QAAQ,CAAC;IAC3C,MAAMC,aAAaX,MAAMY,MAAM,CAAY;IAC3C,MAAMC,aAAaZ,kBAAkBK;IAErC,MAAMQ,QAAQd,MAAMe,WAAW,CAAC,IAAMN,UAAU,OAAO,EAAE;IACzD,MAAMO,SAAShB,MAAMe,WAAW,CAAC,IAAMN,UAAU,QAAQ,EAAE;IAE3D,+DAA+D;IAC/D,MAAMQ,uBAAuBjB,MAAMe,WAAW,CAAC;QAC7C,IAAIJ,WAAWO,OAAO,EAAE;YACtBC,aAAaR,WAAWO,OAAO;YAC/BP,WAAWO,OAAO,GAAG;QACvB;IACF,GAAG,EAAE;IAEL,MAAME,uBAAuBpB,MAAMe,WAAW,CAAC;QAC7C,IAAI,CAACR,YAAY,CAACH,WAAWI,QAAQ;YACnC;QACF;QAEA,IAAID,SAASc,eAAe,KAAK,WAAW;YAC1CJ;YACAN,WAAWO,OAAO,GAAGI,WAAWT,YAAYT;QAC9C,OAAO;YACLa;QACF;IACF,GAAG;QAACV;QAAUH;QAASI;QAAQS;QAAsBJ;KAAW;IAEhE,mDAAmD;IACnDb,MAAMuB,SAAS,CACb,SAASC;QACP,IAAI,CAACjB,YAAY,CAACH,WAAWI,QAAQ;YACnC;QACF;QAEAY;QACAb,SAASkB,gBAAgB,CAAC,oBAAoBL;QAE9C,OAAO;YACLH;YACAV,SAASmB,mBAAmB,CAAC,oBAAoBN;QACnD;IACF,GACA;QAACb;QAAUH;QAASC;QAAYe;QAAsBH;QAAsBT;KAAO;IAGrF,OAAO;QACLQ;QACAF;IACF;AACF"}