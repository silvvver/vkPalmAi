{"version":3,"sources":["../../../src/components/Alert/AlertBase.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { Icon20Cancel } from '@vkontakte/icons';\nimport { classNames, hasReactNode, noop } from '@vkontakte/vkjs';\nimport { useAdaptivityWithJSMediaQueries } from '../../hooks/useAdaptivityWithJSMediaQueries';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useCSSKeyframesAnimationController } from '../../lib/animation';\nimport { stopPropagation } from '../../lib/utils';\nimport { FocusTrap } from '../FocusTrap/FocusTrap';\nimport { IconButton } from '../IconButton/IconButton';\nimport { ModalDismissButton } from '../ModalDismissButton/ModalDismissButton';\nimport { type AlertActionInterface, type AlertProps } from './Alert';\nimport { AlertActions } from './AlertActions';\nimport { AlertDescription, AlertTitle } from './AlertTypography';\nimport styles from './Alert.module.css';\n\nexport interface AlertBaseProps\n  extends Omit<AlertProps, 'usePortal' | 'className' | 'style' | 'getRootRef'> {\n  /**\n   * Флаг, определяющий состояние закрытия модального окна.\n   * Когда установлен в true, запускает анимацию закрытия окна.\n   */\n  closing?: boolean;\n  /**\n   * Функция обратного вызова для управления состоянием закрытия модального окна.\n   * Принимает булево значение, которое определяет, находится ли окно в процессе закрытия.\n   */\n  setClosing?: (closing: boolean) => void;\n}\n\nexport const AlertBase = ({\n  actions,\n  actionsLayout = 'horizontal',\n  children,\n  title,\n  description,\n  onClose,\n  dismissLabel = 'Закрыть предупреждение',\n  renderAction,\n  actionsAlign,\n  dismissButtonMode = 'outside',\n  dismissButtonTestId,\n  onClick,\n  allowClickPropagation = false,\n  titleTestId,\n  descriptionTestId,\n  closing,\n  setClosing,\n  ...restProps\n}: AlertBaseProps) => {\n  const generatedId = React.useId();\n\n  const titleId = `vkui-alert-${generatedId}-title`;\n  const descriptionId = `vkui-alert-${generatedId}-description`;\n\n  const platform = usePlatform();\n  const { isDesktop } = useAdaptivityWithJSMediaQueries();\n  const itemActionCallbackRef = React.useRef(noop);\n  const [animationState, animationHandlers] = useCSSKeyframesAnimationController(\n    closing ? 'exit' : 'enter',\n    {\n      onExited() {\n        itemActionCallbackRef.current();\n        itemActionCallbackRef.current = noop;\n        onClose();\n      },\n    },\n  );\n  const isDismissButtonVisible = isDesktop && platform !== 'ios';\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  const close = React.useCallback(() => {\n    setClosing?.(true);\n  }, [setClosing]);\n\n  const onItemClick = React.useCallback(\n    (item: AlertActionInterface) => {\n      const { action: itemAction, autoCloseDisabled = false } = item;\n\n      if (autoCloseDisabled) {\n        itemAction && itemAction({ close });\n      } else {\n        if (itemAction) {\n          itemActionCallbackRef.current = itemAction;\n        }\n        setClosing?.(true);\n      }\n    },\n    [close, setClosing],\n  );\n\n  const handleClick = allowClickPropagation\n    ? onClick\n    : (event: React.MouseEvent<HTMLElement>) => {\n        stopPropagation(event);\n        onClick?.(event);\n      };\n\n  return (\n    <FocusTrap\n      {...animationHandlers}\n      onClick={handleClick}\n      getRootRef={elementRef}\n      onClose={close}\n      autoFocus={animationState === 'entered'}\n      className={classNames(\n        styles.host,\n        platform === 'ios' && styles.ios,\n        platform === 'vkcom' && styles.vkcom,\n        closing ? styles.closing : styles.opening,\n        isDesktop && styles.desktop,\n      )}\n      role=\"alertdialog\"\n      aria-modal\n      aria-labelledby={titleId}\n      aria-describedby={descriptionId}\n      {...restProps}\n    >\n      <div\n        className={classNames(\n          styles.content,\n          dismissButtonMode === 'inside' && styles.contentWithButton,\n        )}\n      >\n        {hasReactNode(title) && (\n          <AlertTitle data-testid={titleTestId} id={titleId}>\n            {title}\n          </AlertTitle>\n        )}\n        {hasReactNode(description) && (\n          <AlertDescription data-testid={descriptionTestId} id={descriptionId}>\n            {description}\n          </AlertDescription>\n        )}\n        {children}\n        {isDismissButtonVisible && dismissButtonMode === 'inside' && (\n          <IconButton\n            label={dismissLabel}\n            className={classNames(styles.dismiss, 'vkuiInternalAlert__dismiss')}\n            onClick={close}\n            hoverMode=\"opacity\"\n            activeMode=\"opacity\"\n            data-testid={dismissButtonTestId}\n          >\n            <Icon20Cancel />\n          </IconButton>\n        )}\n      </div>\n      {isDismissButtonVisible && dismissButtonMode === 'outside' && (\n        <ModalDismissButton onClick={close} data-testid={dismissButtonTestId}>\n          {dismissLabel}\n        </ModalDismissButton>\n      )}\n      <AlertActions\n        actions={actions}\n        actionsAlign={actionsAlign}\n        actionsLayout={actionsLayout}\n        renderAction={renderAction}\n        onItemClick={onItemClick}\n      />\n    </FocusTrap>\n  );\n};\n"],"names":["React","Icon20Cancel","classNames","hasReactNode","noop","useAdaptivityWithJSMediaQueries","usePlatform","useCSSKeyframesAnimationController","stopPropagation","FocusTrap","IconButton","ModalDismissButton","AlertActions","AlertDescription","AlertTitle","AlertBase","actions","actionsLayout","children","title","description","onClose","dismissLabel","renderAction","actionsAlign","dismissButtonMode","dismissButtonTestId","onClick","allowClickPropagation","titleTestId","descriptionTestId","closing","setClosing","restProps","generatedId","useId","titleId","descriptionId","platform","isDesktop","itemActionCallbackRef","useRef","animationState","animationHandlers","onExited","current","isDismissButtonVisible","elementRef","close","useCallback","onItemClick","item","action","itemAction","autoCloseDisabled","handleClick","event","getRootRef","autoFocus","className","role","aria-modal","aria-labelledby","aria-describedby","div","data-testid","id","label","hoverMode","activeMode"],"mappings":"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"}