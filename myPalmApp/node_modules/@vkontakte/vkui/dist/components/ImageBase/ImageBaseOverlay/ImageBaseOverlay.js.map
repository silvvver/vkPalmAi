{"version":3,"sources":["../../../../src/components/ImageBase/ImageBaseOverlay/ImageBaseOverlay.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useColorScheme } from '../../../hooks/useColorScheme';\nimport { useExternRef } from '../../../hooks/useExternRef';\nimport { useFocusVisible } from '../../../hooks/useFocusVisible';\nimport { useFocusVisibleClassName } from '../../../hooks/useFocusVisibleClassName';\nimport { clickByKeyboardHandler } from '../../../lib/utils';\nimport { ImageBaseContext } from '../context';\nimport { validateOverlayIcon } from '../validators';\nimport { useCalculatedDefaultVisibility, useNonInteractiveOverlayProps } from './hooks';\nimport type {\n  ImageBaseOverlayInteractiveProps,\n  ImageBaseOverlayNonInteractiveProps,\n} from './types';\nimport styles from './ImageBaseOverlay.module.css';\n\nfunction DevelopmentCheck({ children }: Pick<ImageBaseOverlayInteractiveProps, 'children'>) {\n  const { size } = React.useContext(ImageBaseContext);\n\n  if (process.env.NODE_ENV === 'development') {\n    if (children) {\n      validateOverlayIcon(size, { name: 'children', value: children });\n    }\n  }\n\n  return null;\n}\n\nexport type ImageBaseOverlayProps =\n  | ImageBaseOverlayInteractiveProps\n  | ImageBaseOverlayNonInteractiveProps;\n\nconst ImageBaseOverlayInteractive = ({\n  children,\n  className,\n  getRootRef,\n  overlayShown,\n  ...restProps\n}: ImageBaseOverlayInteractiveProps & { overlayShown?: boolean }) => {\n  const { focusVisible, ...focusEvents } = useFocusVisible();\n  const focusVisibleClassNames = useFocusVisibleClassName({ focusVisible, mode: 'inside' });\n\n  return (\n    <>\n      <div\n        {...restProps}\n        tabIndex={0}\n        role=\"button\"\n        className={classNames(\n          styles.clickable,\n          (focusVisible || overlayShown) && styles.visible,\n          focusVisibleClassNames,\n          className,\n        )}\n        ref={getRootRef}\n        onKeyDown={clickByKeyboardHandler}\n        {...focusEvents}\n      >\n        {children}\n      </div>\n      {process.env.NODE_ENV === 'development' && <DevelopmentCheck>{children}</DevelopmentCheck>}\n    </>\n  );\n};\n\nconst ImageBaseOverlayNonInteractive = ({\n  className,\n  getRootRef,\n  overlayShown: overlayShownProps,\n  ...restProps\n}: ImageBaseOverlayNonInteractiveProps & { overlayShown?: boolean }) => {\n  const rootRef = useExternRef(getRootRef);\n  const { shown: overlayShown, onClick: onOverlayClick } = useNonInteractiveOverlayProps(rootRef);\n\n  return (\n    <div\n      {...restProps}\n      ref={rootRef}\n      className={classNames((overlayShown || overlayShownProps) && styles.visible, className)}\n      onClick={onOverlayClick}\n    />\n  );\n};\n\n/**\n * Оверлей над картинкой.\n */\nexport const ImageBaseOverlay = ({\n  className,\n  theme: themeProp,\n  visibility: visibilityProp,\n  ...restProps\n}: ImageBaseOverlayProps) => {\n  const colorScheme = useColorScheme();\n\n  const theme = themeProp ?? colorScheme;\n\n  const commonClassNames = classNames(\n    styles.host,\n    theme === 'light' && styles.themeLight,\n    theme === 'dark' && styles.themeDark,\n    className,\n  );\n\n  const defaultVisibility = useCalculatedDefaultVisibility();\n  const visibility = visibilityProp ?? defaultVisibility;\n\n  const commonProps = {\n    className: commonClassNames,\n    overlayShown: visibility === 'always',\n  };\n\n  // Не делаем деструктуризацию пропа, потому что Typescript не вывозит\n  if (!restProps.onClick) {\n    return <ImageBaseOverlayNonInteractive {...restProps} {...commonProps} />;\n  }\n\n  return <ImageBaseOverlayInteractive {...restProps} {...commonProps} />;\n};\n"],"names":["React","classNames","useColorScheme","useExternRef","useFocusVisible","useFocusVisibleClassName","clickByKeyboardHandler","ImageBaseContext","validateOverlayIcon","useCalculatedDefaultVisibility","useNonInteractiveOverlayProps","DevelopmentCheck","children","size","useContext","process","env","NODE_ENV","name","value","ImageBaseOverlayInteractive","className","getRootRef","overlayShown","restProps","focusVisible","focusEvents","focusVisibleClassNames","mode","div","tabIndex","role","ref","onKeyDown","ImageBaseOverlayNonInteractive","overlayShownProps","rootRef","shown","onClick","onOverlayClick","ImageBaseOverlay","theme","themeProp","visibility","visibilityProp","colorScheme","commonClassNames","defaultVisibility","commonProps"],"mappings":"AAAA;;;;;AAEA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,SAASC,cAAc,QAAQ,mCAAgC;AAC/D,SAASC,YAAY,QAAQ,iCAA8B;AAC3D,SAASC,eAAe,QAAQ,oCAAiC;AACjE,SAASC,wBAAwB,QAAQ,6CAA0C;AACnF,SAASC,sBAAsB,QAAQ,wBAAqB;AAC5D,SAASC,gBAAgB,QAAQ,gBAAa;AAC9C,SAASC,mBAAmB,QAAQ,mBAAgB;AACpD,SAASC,8BAA8B,EAAEC,6BAA6B,QAAQ,aAAU;AAOxF,SAASC,iBAAiB,EAAEC,QAAQ,EAAsD;IACxF,MAAM,EAAEC,IAAI,EAAE,GAAGb,MAAMc,UAAU,CAACP;IAElC,IAAIQ,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;QAC1C,IAAIL,UAAU;YACZJ,oBAAoBK,MAAM;gBAAEK,MAAM;gBAAYC,OAAOP;YAAS;QAChE;IACF;IAEA,OAAO;AACT;AAMA,MAAMQ,8BAA8B;QAAC,EACnCR,QAAQ,EACRS,SAAS,EACTC,UAAU,EACVC,YAAY,EAEkD,WAD3DC;QAJHZ;QACAS;QACAC;QACAC;;IAGA,MAAyCnB,mBAAAA,mBAAnC,EAAEqB,YAAY,EAAkB,GAAGrB,kBAAhBsB,yCAAgBtB;QAAjCqB;;IACR,MAAME,yBAAyBtB,yBAAyB;QAAEoB;QAAcG,MAAM;IAAS;IAEvF,qBACE;;0BACE,KAACC,mFACKL;gBACJM,UAAU;gBACVC,MAAK;gBACLV,WAAWpB,8CAET,AAACwB,CAAAA,gBAAgBF,YAAW,sCAC5BI,wBACAN;gBAEFW,KAAKV;gBACLW,WAAW3B;gBACPoB;0BAEHd;;YAEFG,QAAQC,GAAG,CAACC,QAAQ,KAAK,+BAAiB,KAACN;0BAAkBC;;;;AAGpE;AAEA,MAAMsB,iCAAiC;QAAC,EACtCb,SAAS,EACTC,UAAU,EACVC,cAAcY,iBAAiB,EAEkC,WAD9DX;QAHHH;QACAC;QACAC;;IAGA,MAAMa,UAAUjC,aAAamB;IAC7B,MAAM,EAAEe,OAAOd,YAAY,EAAEe,SAASC,cAAc,EAAE,GAAG7B,8BAA8B0B;IAEvF,qBACE,KAACP,+CACKL;QACJQ,KAAKI;QACLf,WAAWpB,WAAW,AAACsB,CAAAA,gBAAgBY,iBAAgB,sCAAsBd;QAC7EiB,SAASC;;AAGf;AAEA;;CAEC,GACD,OAAO,MAAMC,mBAAmB;QAAC,EAC/BnB,SAAS,EACToB,OAAOC,SAAS,EAChBC,YAAYC,cAAc,EAEJ,WADnBpB;QAHHH;QACAoB;QACAE;;IAGA,MAAME,cAAc3C;IAEpB,MAAMuC,QAAQC,sBAAAA,uBAAAA,YAAaG;IAE3B,MAAMC,mBAAmB7C,yCAEvBwC,UAAU,+CACVA,UAAU,6CACVpB;IAGF,MAAM0B,oBAAoBtC;IAC1B,MAAMkC,aAAaC,2BAAAA,4BAAAA,iBAAkBG;IAErC,MAAMC,cAAc;QAClB3B,WAAWyB;QACXvB,cAAcoB,eAAe;IAC/B;IAEA,qEAAqE;IACrE,IAAI,CAACnB,UAAUc,OAAO,EAAE;QACtB,qBAAO,KAACJ,mDAAmCV,WAAewB;IAC5D;IAEA,qBAAO,KAAC5B,gDAAgCI,WAAewB;AACzD,EAAE"}